---
//@ts-nocheck
import Layout1 from "../layouts/Layout1.astro";
import Hero from "../sections/hero.astro";

const title = "The Simpsons | MacV";

const response_characters = await fetch(
  "https://thesimpsonsapi.com/api/characters",
);
const data_character = await response_characters.json();
const characters = data_character.results;
---

<Layout1 title={title} />
<Hero title="The Simpsons" bg_image="/img/thesimpsons/bg.jpg" />

<section id="characters">
  <input type="text" id="search" placeholder="search.." />
  <h3 id="no-results" style="display: none;">No results</h3>
  <div class="grid flex-row">
    {
      characters.map((character) => (
        <a
          href={`/${character.id}`}
          class="character-card flex-column"
          data-name={character.name.toLowerCase()}
        >
          <img
            src={`https://cdn.thesimpsonsapi.com/200${character.portrait_path}`}
            alt={character.name}
            transition:name={`img-${character.id}`}
          />
          <h4 title={character.name} transition:name={`name-${character.id}`}>
            {character.name}
          </h4>
        </a>
      ))
    }
  </div>
</section>

<style>
  body {
    background-color: #d5e0f7;
  }
  .grid {
    flex-wrap: wrap;
    gap: 10px;
    align-items: stretch;
    width: 100%;
  }

  .character-card {
    align-items: start;
    justify-content: start;
    text-align: left;
    border: solid 1px transparent;
    padding: 10px 15px;
    border-radius: 7px;
    width: calc((100% - 10px) / 2);
    max-width: 200px;

    transition: var(--transition);
    color: var(--clr-dark);
  }

  .character-card img {
    width: 100%;
    aspect-ratio: 1 / 1;
    mask-image: linear-gradient(to bottom, white 70%, transparent 100%);
  }

  .character-card h4 {
    white-space: nowrap; /* No permite saltos de lÃ­nea */
    overflow: hidden; /* Esconde lo que se sale */
    text-overflow: ellipsis; /* Agrega los ... */
    width: 100%;
    text-align: center;
  }

  #search {
    max-width: 400px;
  }

  #no-results {
    text-align: center;
    padding: 20px;
    color: var(--clr-text);
    font-size: 1.1rem;
  }

  @media (hover: hover) {
    .character-card:hover {
      background-color: #fff;
      border: solid 1px var(--clr-border);
      scale: 1.02;
      cursor: pointer;
    }
  }

  @media (min-width: 750px) {
  }
</style>

<script>
  //@ts-nocheck
  //Obtener elementos del DOM
  const searchInput = document.getElementById("search");
  const characterCards = document.querySelectorAll(".character-card");

  //FunciÃ³n para filtrar personajes
  function filterCharacters() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    let visibleCount = 0;

    characterCards.forEach((card) => {
      const characterName = card.getAttribute("data-name");

      if (characterName.includes(searchTerm)) {
        card.style.display = "flex";
        visibleCount++;
      } else {
        card.style.display = "none";
      }
    });

    // ðŸ‘‡ Mostrar/ocultar mensaje segÃºn resultados
    const noResultsMessage = document.getElementById("no-results");
    if (visibleCount === 0) {
      noResultsMessage.style.display = "block";
    } else {
      noResultsMessage.style.display = "none";
    }
  }

  // 3. Escuchar cuando escribes en el input
  searchInput.addEventListener("input", filterCharacters);
</script>
